# PROD Environment: 테스트/포트폴리오용 최소 스펙
# 비용 최적화 버전 (2026-01-06)
# ⚠️ 주의: 실 운영용이 아닌 테스트/데모 전용 설정

# AWS 리전
aws_region = "ap-southeast-2"

# AWS 계정 ID (필수)
aws_account_id = "827913617839"

# 프로젝트 설정
project_name = "kyeol"
owner_prefix = "min"
environment  = "prod"

# VPC CIDR
vpc_cidr = "10.30.0.0/16"

# 가용영역 (2AZ - 비용 최적화, 3AZ → 2AZ)
azs = ["ap-southeast-2a", "ap-southeast-2c"]

# =============================================================================
# EKS 설정 (테스트 스펙)
# =============================================================================
eks_cluster_version     = "1.32"  # 1.29 → 1.32 (Standard support until 2026-03)
eks_node_instance_types = ["t3.medium"]   # t3.xlarge → t3.medium
eks_node_desired_size   = 2               # 4 → 2
eks_node_min_size       = 1               # 3 → 1
eks_node_max_size       = 3               # 10 → 3

# =============================================================================
# RDS 설정 (테스트 스펙)
# =============================================================================
rds_instance_class          = "db.t4g.small"  # r6g.large → t4g.small
rds_multi_az                = false           # Multi-AZ 비활성화
rds_allocated_storage       = 30              # 100GB → 30GB
rds_deletion_protection     = false           # 삭제 보호 비활성화
rds_backup_retention_period = 1               # 30일 → 1일

# Route53 Hosted Zone ID
hosted_zone_id = "ZXXXXXXXXXX"

# =============================================================================
# Cache (비활성화 - 비용 절감)
# =============================================================================
enable_cache = false  # true → false

# Monitoring (비활성화)
enable_enhanced_monitoring = false
enable_cloudwatch_logs     = false

# =============================================================================
# VPC Endpoints (S3만 유지 - 비용 최적화)
# =============================================================================
enable_s3_endpoint   = true
enable_ecr_endpoints = false  # true → false
enable_logs_endpoint = false  # true → false
enable_sts_endpoint  = false  # true → false

# =============================================================================
# 결제 전용 NAT + 격리 서브넷 (PG사 화이트리스트용)
# =============================================================================
enable_payment_nat = true

# 결제 전용 Node Group (Taint: payment=true:NoSchedule)
payment_node_instance_types = ["t3.small"]
payment_node_desired_size   = 1
payment_node_min_size       = 1
payment_node_max_size       = 2

# =============================================================================
# S3/로깅 (최소화)
# =============================================================================
enable_phase3_s3          = false  # S3 버킷 불필요
logs_retention_days       = 7
enable_kms_encryption     = false
enable_glacier_transition = false
enable_fluent_bit_irsa    = false

# =============================================================================
# CloudTrail (비활성화 - 테스트 환경)
# =============================================================================
enable_cloudtrail             = false  # true → false
enable_cloudtrail_data_events = false
enable_cloudtrail_cloudwatch  = false
enable_cloudtrail_kms         = false

# =============================================================================
# NAT Gateway (비용 주의: 월 $32+)
# PROD: 운영 필수
# =============================================================================
enable_nat_gateway = true

# =============================================================================
# CloudWatch Logs (ISMS-P 기준 + 비용 최적화)
# PROD: audit 로그만 활성화 (ISMS-P 감사 필수)
#   - api: 비활성화 (비용 높음, 디버깅용)
#   - audit: 활성화 (ISMS-P 필수)
#   - authenticator: 선택 (보안 강화 시)
# =============================================================================
enabled_cluster_log_types = ["audit"]  # ISMS-P 최소 요구사항

# =============================================================================
# RDS Performance Insights (비용 주의: 7일 무료, 이후 과금)
# PROD: 성능 분석 필요 시에만 활성화
# =============================================================================
enable_performance_insights    = false  # 필요 시 true
performance_insights_retention = 7      # 무료 범위

